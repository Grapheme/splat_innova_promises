<?php $__env->startSection('content'); ?>
<div class="row">

	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-5">

        <h1>Модули</h1>

		<form action="<?php echo URL::route('modules.change'); ?>" class="smart-form">
                <?php /*<label class="label">Список доступных модулей:</label>*/ ?>

                <table class="table table-bordered table-striped white-bg modules-list">
                    <?
                    #Helper::d(SystemModules::getModules());
                    $modules_info = Config::get('mod_info');
                    $modules = Allow::modules();
                    #Helper::tad($modules);
                    #Helper::tad($modules_info);
                    ?>
                    <tbody class="sortable">
                        <?php foreach($modules as $name => $module): ?>
                        <?
                        if (!isset($modules_info[$module->name]) || !@$modules_info[$module->name]['visible'])
                            continue;
                        ?>
                        <tr data-id="<?php echo @$module->id; ?>">
                            <td><?php echo @$modules_info[$module->name]['title']; ?></td>
                            <td style="width: 50px;">
                                <label class="toggle">
                                    <?php $checked = ''; ?>
                                    <?php if(Allow::module($module->name)): ?>
                                        <?php $checked = ' checked="checked"'; ?>
                                    <?php endif; ?>
                                    <input type="checkbox"<?php echo $checked; ?> class="module-checkbox" data-name="<?php echo $module->name; ?>">
                                    <i data-swchon-text="вкл" data-swchoff-text="выкл"></i>
                                </label>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
				</table>

		</form>
	</div>

</div>
<?php $__env->stopSection(); ?>


<?php $__env->startSection('scripts'); ?>

    <script>
        $(document).on("mouseover", ".modules-list .sortable", function(e){
            // Check flag of sortable activated
            if ( !$(this).data('sortable') ) {
                // Activate sortable, if flag is not initialized
                $(this).sortable({
                    // On finish of sorting
                    stop: function() {
                        // Find all playlists
                        var pls = $(this).find('tr');
                        var poss = [];
                        // Make array with current sorting order
                        $(pls).each(function(i, item) {
                            poss.push($(item).data('id'));
                        });
                        console.log(poss);
                        // Send ajax request to server for saving sorting order
                        $.ajax({
                            url: "<?php echo URL::route('modules.order'); ?>",
                            type: "post",
                            data: {poss: poss},
                            success: function() {}
                        });
                    }
                });
            }
        });
    </script>
<?php $__env->stopSection(); ?>


<?php echo $__env->make(Helper::acclayout(), array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>