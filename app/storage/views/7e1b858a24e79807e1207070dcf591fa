<?php $__env->startSection('content'); ?>

    <h1>Управление изображениями</h1>

    <div style="margin: 10px 0 25px;">
    	<a class="btn btn-primary" data-toggle="modal" data-target="#gallery">Добавить галерею</a>
    </div>
    
    <?php if(@is_object($galleries) && $galleries->count()): ?>
    <table class="table table-bordered table-striped min-table">
    <thead>
    	<tr>
    		<th>Название</th>
    		<th style="width: 100px;"></th>
    		<th style="width: 100px;"></th>
    	</tr>
    </thead>
    <tbody>
    
    	<?php foreach($galleries as $gallery): ?>
    	<tr>
    		<td><?php echo $gallery->name; ?></td>
    		<td><a href="<?php echo link::to('admin/galleries/edit/'.$gallery->id); ?>" class="btn btn-default">Редактировать</a></td>
    		<td><a class="gallery-delete-btn btn btn-default" href="#" data-id="<?php echo $gallery->id; ?>">Удалить</a></td>
    	</tr>
    
    	<?php endforeach; ?>
    </tbody>
    </table>
    <?php else: ?>
    	There are no galleries.
    <?php endif; ?>

    <div class="modal fade in" id="gallery" tabindex="-1">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<div class="modal-header">
    				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
    					×
    				</button>
    				<h4 class="modal-title" id="myModalLabel">Add new gallery</h4>
    			</div>
    			<div class="modal-body">
    
    				<div class="row">
    					<div class="col-md-12">
    						<form id="add-lang" class="form-ajax-submit" action="<?php echo link::to('admin/galleries/create'); ?>">
    							<div class="form-group">
    								<label>Name:</label>
    								<input class="form-control" name="name" type="text">
    								<input class="form-control" name="settings" type="hidden" value="">
    							</div>
    							<input type="submit" class="btn btn-primary" data-id="add-lang" value="add">
    						</form>
    					</div>
    				</div>
    		</div><!-- /.modal-content -->
    	</div><!-- /.modal-dialog -->
    </div>

<?php $__env->stopSection(); ?>


<?php $__env->startSection('scripts'); ?>

	<script>
	$(function(){
		$('.form-ajax-submit').on('submit', function(event){

			event.preventDefault();

			var $_form = $(this);
			var $data = {};

			$_form.find('input').not('input[type=submit]').each(function(){
				$data[$(this).attr('name')] = $(this).val();
			});

			$.ajax({
				url: $_form.attr('action'),
				data: $data,
				type: 'post',
            }).done(function(href){
            	window.location.href = href;
            }).fail(function(data){
            	var $errors = data.responseJSON;

                $.bigBox({
                    title : "Error!",
                    content : $errors,
                    color : "#C46A69",
                    timeout: 15000,
                    icon : "fa fa-warning shake animated",
                });
            });

		});

		$('.gallery-delete-btn').click(function(){

			var $that = $(this).parent().parent();
			var $id = $(this).attr('data-id');

			$.ajax({
				url: '<?php echo URL::to('admin/galleries/delete'); ?>',
				data: { id: $id },
				type: 'post',
            }).done(function(){
            	$that.fadeOut('fast');
            });

			return false;
		});
	});
	</script>

<?php $__env->stopSection(); ?>
<?php echo $__env->make('templates.'.AuthAccount::getStartPage(), array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>