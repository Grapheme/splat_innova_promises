<?
$ach_list = [];
if (isset($achievements) && count($achievements)) {
    foreach ($achievements as $achievement) {
        $ach_list[] = [
            'name' => $achievement->name,
            'desc' => $achievement->desc,
            'icon' => isset($achievement->image) && is_object($achievement->image) ? $achievement->image->full() : '',
        ];
    }
}
?>
<?php /*<!-- <?php echo Helper::ta(Config::get('site.achievements')); ?> -->*/ ?>
<?php /*<!-- <?php echo Helper::ta($achievements); ?> -->*/ ?>


<?php $__env->startSection('style'); ?>
<?php $__env->stopSection(); ?>


<?php $__env->startSection('koe-chto'); ?>
    <li class="promise-item type-promo">
        <div class="promise-content">
            <div class="logo"></div>
            <div class="text">
                <p>КАЖДЫЙ РАЗ, ВЫПОЛНЯЯ ОБЕЩАНИЯ,<br>ВЫ СТАНОВИТЕСЬ СИЛЬНЕЕ.</p>
                <p>МЫ ТОЖЕ ХОТИМ <a href="#" class="js-open-box" data-box="promo" onclick="ga('send', 'event', 'brand', 'friend');">ДАТЬ ВАМ ОБЕЩАНИЕ</a></p>
            </div>
        </div>
    </li>
<?php $__env->stopSection(); ?>


<?php $__env->startSection('content'); ?>

    <?php if(0): ?>

        <big><a href="<?php echo $user->identity; ?>" target="_blank"><?php echo $user->name; ?></a></big>

        <br/>

        Обещаний: <?php echo @count($promises); ?><br/>

        <?php if(isset($promises) && is_object($promises) && count($promises)): ?>

            Обещания пользователя:

            <?php echo Helper::ta($promises); ?>


            <ul>
            <?php foreach($promises as $promise): ?>
                <?php echo Helper::ta_($promise); ?>

                <?
                if ($promise->only_for_me)
                    continue;
                ?>
                <li><a href="<?php echo URL::route('app.promise', $promise->id); ?>"><?php echo $promise->name; ?></a></li>
            <?php endforeach; ?>
            </ul>
        <?php else: ?>

            <div class="wrapper">
              <div class="us-text">Этот пользователь уже зарегистрирован на сайте, но пока не давал обещаний.</div>
            </div>

        <?php endif; ?>

    <?php endif; ?>


    <?
    $default_avatar = '/theme/images/man.png';
    if (isset($user->sex) && $user->sex == 1)
        $default_avatar = '/theme/images/woman.png';
    ?>

      <div class="profile-page">
        <div class="wrapper">
          <div class="profile-card">
            <div style="background-image: url(<?php echo $user->avatar ?: $default_avatar; ?>);" class="profile-photo"></div>
            <div class="profile-info">
              <div class="info-cont">
                <div class="name"><span><?php echo $user->name; ?></span></div>
                <?php if($user->years_old && 0): ?>
                  <div class="age">
                    <?php echo trans_choice(':count год|:count года|:count лет', $user->years_old, array(), 'ru'); ?>

                  </div>
                <?php endif; ?>
                <?php if($user->city): ?>
                  <?php echo $user->city; ?>

                <?php endif; ?>
                <div class="achives js-achives"></div>
              </div>
            </div>
            <?php /*
              <div class="btn-cont">
                <a href="#" class="us-btn">Подписаться</a>
                <a href="#" class="us-btn btn-unfollow">Отписаться</a>
              </div>
            */ ?>
          </div>
          <div class="promises-title us-title">Обещания</div>
        </div>


        <?php if(isset($promises) && is_object($promises) && count($promises)): ?>

            <?
            $p = 0;
            ?>
            <ul class="promises-list">
            <?php foreach($promises as $promise): ?>
            <?
            ++$p;
            if (!$promise->style_id) {
                $styles = array('green', 'aqua', 'yellow', 'blue', 'pink');
                $promise->style_id = $styles[array_rand($styles)];
            }
            ?>
              <li class="promise-item type-<?php echo $promise->style_id; ?>" data-finish="<?php echo $promise->time_limit; ?>">
                <ul class="soc-block">
                  <li><a onclick="ga('send', 'event', 'like', 'facebook');" href="http://www.facebook.com/sharer.php?u=<?php echo URL::route('app.promise', $promise->id); ?>" class="soc-icon" target="_blank"><i class="fi icon-fb"></i></a></li>
                  <li><a onclick="ga('send', 'event', 'like', 'vkontakte');" href="http://vk.com/share.php?url=<?php echo URL::route('app.promise', $promise->id); ?>&event=button_share" class="soc-icon" target="_blank"><i class="fi icon-vk"></i></a></li>
                  <li><a onclick="ga('send', 'event', 'like', 'odnoklassniki');" href="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl=<?php echo URL::route('app.promise', $promise->id); ?>" class="soc-icon" target="_blank"><i class="fi icon-ok"></i></a></li>
                </ul>
                <a href="<?php echo URL::route('app.promise', $promise->id); ?>" class="promise-content">
                  <div class="title">
                    <?php echo $promise->name; ?>

                  </div>
                  <div class="bottom-block">
                    <div class="top-floor">
                      <div class="time js-time-countdown"></div>
                        <?php if($promise->only_for_me): ?>
                            <div class="eye eye-cross" data-tooltip="Обещание защищено настройками приватности<br>и видимо только вам."></div>
                        <?php else: ?>
                            <div class="eye" data-tooltip="Обещание видно всем пользователям."></div>
                        <?php endif; ?>
                      <!-- <div class="eye<?php echo ( $promise->only_for_me ? ' eye-cross' : ''); ?>"></div> -->
                    </div>
                    <div class="bottom-floor">
                      <!--
                      <div class="views">15</div>
                      -->
                      <div class="comments" data-tooltip="<?php echo trans_choice(':count комментарий|:count комментария|:count комментариев', (int)$promise->comments_count, array(), 'ru'); ?> к этому обещанию."><?php echo $promise->comments_count; ?></div>

                        <?
                        $failed = !$promise->finished_at && ($promise->promise_fail || date('Y-m-d H:i:s') > $promise->time_limit);
                        ?>
                        <?php if($failed): ?>
                            <div class="unsmile" data-tooltip="Обещание не было выполнено.">
                                <!-- <i class="fi icon-no"></i> -->
                            </div>
                        <?php elseif($promise->finished_at): ?>
                            <div class="smile" data-tooltip="Обещание выполнено.">
                                <!-- <i class="fi icon-okey"></i> -->
                            </div>
                        <?php else: ?>
                            <!-- <div class="time">02:01:23</div> -->
                        <?php endif; ?>

                    </div>
                  </div>
                </a>
              </li>

                <?php if(@$p == 2): ?>
                    <?php echo $__env->yieldContent('koe-chto'); ?>
                <?php endif; ?>

            <?php endforeach; ?>

            <?php if(@$p == 1): ?>
                <?php echo $__env->yieldContent('koe-chto'); ?>
            <?php endif; ?>

            </ul>
        <?php else: ?>

            <div class="wrapper">
              <div class="us-text">Этот пользователь уже зарегистрирован на сайте, но пока не давал обещаний.</div>
            </div>
            
        <?php endif; ?>

    <script>
        var __SITE__ = {};
        __SITE__.achievements = <?php echo json_encode($ach_list, JSON_UNESCAPED_UNICODE); ?>;
    </script>

<?php $__env->stopSection(); ?>


<?php $__env->startSection('scripts'); ?>

<?php $__env->stopSection(); ?>
<?php echo $__env->make(Helper::layout(), array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>